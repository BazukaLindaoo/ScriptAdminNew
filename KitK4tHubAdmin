-- SCRIPT FINAL: Brookhaven-ready (v3.1)
-- Painel + Sistema de Autoriza√ß√£o + Tags + Comandos via Chat

local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- üîπ Lista de autorizados (carrega online)
local AUTHORIZED_PLAYERS = nil
pcall(function()
	AUTHORIZED_PLAYERS = loadstring(game:HttpGet("https://raw.githubusercontent.com/KitK4tHub/users/refs/heads/main/users/allow.lua"))()
end)

-- üîπ Tags especiais fixas
local SPECIAL_TAGS = {
	["Breno010L"] = "üëë Dono KitK4t",
	["shawnlovebazuka"] = "üí† Sub Dona KitK4t"
}

-- üîπ Controle de tags aplicadas
local ActiveTags = {}

-- Fun√ß√£o para verificar autoriza√ß√£o
local function SafeIsAuthorized(name)
	if type(AUTHORIZED_PLAYERS) ~= "table" then return false end
	for _, v in ipairs(AUTHORIZED_PLAYERS) do
		if tostring(v):lower() == tostring(name):lower() then
			return true
		end
	end
	return false
end

-- Fun√ß√£o para verificar se o jogador local √© autorizado
local function IsPlayerAuthorized()
	if SPECIAL_TAGS[LocalPlayer.Name] then return true end
	return SafeIsAuthorized(LocalPlayer.Name)
end

-- Efeito visual
local function CreateBillCipherEffect()
	local char = LocalPlayer.Character
	if not char then return end
	local hrp = char:FindFirstChild("HumanoidRootPart")
	if not hrp then return end
	local fire = Instance.new("Fire")
	fire.Name = "KitK4tFire"
	fire.Color = Color3.fromRGB(0, 100, 255)
	fire.SecondaryColor = Color3.fromRGB(0, 180, 255)
	fire.Size = 8
	fire.Heat = 2
	fire.Parent = hrp
	task.delay(2, function()
		if fire and fire.Parent then fire:Destroy() end
	end)
end

-- üîπ Cria√ß√£o / remo√ß√£o de tags
local function RemovePlayerTag(playerName)
	if ActiveTags[playerName] then
		local tagData = ActiveTags[playerName]
		if tagData.Billboard and tagData.Billboard.Parent then
			pcall(function() tagData.Billboard:Destroy() end)
		end
		ActiveTags[playerName] = nil
		return true
	end
	return false
end

local function CreatePlayerTag(playerName, tagText)
	local player = Players:FindFirstChild(playerName)
	if not player or not player.Character then return false end
	local head = player.Character:FindFirstChild("Head")
	if not head then return false end

	RemovePlayerTag(playerName)

	local billboard = Instance.new("BillboardGui")
	billboard.Name = "KitK4tTag"
	billboard.Adornee = head
	billboard.Size = UDim2.new(0, 150, 0, 30)
	billboard.StudsOffset = Vector3.new(0, 2.5, 0)
	billboard.AlwaysOnTop = true
	billboard.MaxDistance = 120
	billboard.Parent = head

	local bg = Instance.new("Frame")
	bg.Size = UDim2.new(1, 0, 1, 0)
	bg.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	bg.BackgroundTransparency = 0.25
	bg.BorderSizePixel = 0
	bg.Parent = billboard

	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 6)
	corner.Parent = bg

	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(1, -8, 1, -8)
	label.Position = UDim2.new(0, 4, 0, 4)
	label.BackgroundTransparency = 1
	label.Text = tagText
	label.TextColor3 = Color3.fromRGB(255, 255, 255)
	label.TextSize = 12
	label.Font = Enum.Font.GothamBold
	label.TextStrokeTransparency = 0
	label.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
	label.Parent = bg

	local glow = Instance.new("UIStroke")
	glow.Color = Color3.fromRGB(0, 100, 255)
	glow.Thickness = 1
	glow.Parent = bg

	ActiveTags[playerName] = { Billboard = billboard, TagText = tagText }
	return true
end

-- üîπ Atualizador autom√°tico de tags (verifica a cada 2s)
task.spawn(function()
	while task.wait(2) do
		for _, plr in ipairs(Players:GetPlayers()) do
			if plr and plr ~= LocalPlayer then
				if SPECIAL_TAGS[plr.Name] then
					if not ActiveTags[plr.Name] then
						CreatePlayerTag(plr.Name, SPECIAL_TAGS[plr.Name])
					end
				elseif SafeIsAuthorized(plr.Name) then
					if not ActiveTags[plr.Name] then
						CreatePlayerTag(plr.Name, "üõ°Ô∏è Moderador KitK4t")
					end
				else
					if ActiveTags[plr.Name] then
						RemovePlayerTag(plr.Name)
					end
				end
			end
		end
	end
end)

-- üîπ Enviar comando no chat (compat√≠vel com TextChatService e chat antigo)
local function SendCommandMessage(cmd, target)
	local message = "$$$" .. cmd
	if target and target ~= "" then
		message = message .. " " .. target
	end

	if TextChatService.ChatInputBarConfiguration then
		local channel = TextChatService.TextChannels:FindFirstChild("RBXGeneral")
			or TextChatService.TextChannels:FindFirstChild("All")
			or TextChatService.TextChannels:FindFirstChild("General")
		if channel then
			channel:SendAsync(message)
			return
		end
	end

	local chatEvents = game:GetService("ReplicatedStorage"):FindFirstChild("DefaultChatSystemChatEvents")
	if chatEvents and chatEvents:FindFirstChild("SayMessageRequest") then
		chatEvents.SayMessageRequest:FireServer(message, "All")
	end
end

-- üîπ Interface (s√≥ para autorizados)
if IsPlayerAuthorized() then
	task.spawn(function()
		task.wait(0.8)

		local playerGui = LocalPlayer:WaitForChild("PlayerGui")
		local ScreenGui = Instance.new("ScreenGui")
		ScreenGui.Name = "KitK4tHub"
		ScreenGui.Parent = playerGui
		ScreenGui.ResetOnSpawn = false

		local MainFrame = Instance.new("Frame")
		MainFrame.Size = UDim2.new(0, 280, 0, 350)
		MainFrame.Position = UDim2.new(0.5, -140, 0.5, -175)
		MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 45)
		MainFrame.BorderSizePixel = 0
		MainFrame.Parent = ScreenGui

		local UICorner = Instance.new("UICorner")
		UICorner.CornerRadius = UDim.new(0, 8)
		UICorner.Parent = MainFrame

		local TitleBar = Instance.new("Frame")
		TitleBar.Size = UDim2.new(1, -10, 0, 25)
		TitleBar.Position = UDim2.new(0, 5, 0, 5)
		TitleBar.BackgroundColor3 = Color3.fromRGB(0, 100, 255)
		TitleBar.BorderSizePixel = 0
		TitleBar.Parent = MainFrame

		local TitleLabel = Instance.new("TextLabel")
		TitleLabel.Size = UDim2.new(1, -50, 1, 0)
		TitleLabel.Position = UDim2.new(0, 8, 0, 0)
		TitleLabel.BackgroundTransparency = 1
		TitleLabel.Text = "üîÆ KitK4t Hub | Painel"
		TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
		TitleLabel.TextSize = 12
		TitleLabel.Font = Enum.Font.GothamBold
		TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
		TitleLabel.Parent = TitleBar

		local CloseButton = Instance.new("TextButton")
		CloseButton.Size = UDim2.new(0, 20, 0, 20)
		CloseButton.Position = UDim2.new(1, -25, 0.5, -10)
		CloseButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
		CloseButton.BorderSizePixel = 0
		CloseButton.Text = "√ó"
		CloseButton.TextColor3 = Color3.fromRGB(0, 100, 255)
		CloseButton.TextSize = 14
		CloseButton.Font = Enum.Font.GothamBold
		CloseButton.Parent = TitleBar

		local ScrollingFrame = Instance.new("ScrollingFrame")
		ScrollingFrame.Size = UDim2.new(1, -10, 1, -40)
		ScrollingFrame.Position = UDim2.new(0, 5, 0, 35)
		ScrollingFrame.BackgroundTransparency = 1
		ScrollingFrame.ScrollBarThickness = 3
		ScrollingFrame.ScrollBarImageColor3 = Color3.fromRGB(0, 100, 255)
		ScrollingFrame.Parent = MainFrame

		local PlayerTextBox = Instance.new("TextBox")
		PlayerTextBox.Size = UDim2.new(1, 0, 0, 30)
		PlayerTextBox.PlaceholderText = "Digite nome..."
		PlayerTextBox.BackgroundColor3 = Color3.fromRGB(40, 40, 70)
		PlayerTextBox.TextColor3 = Color3.fromRGB(255, 255, 255)
		PlayerTextBox.TextSize = 11
		PlayerTextBox.Font = Enum.Font.Gotham
		PlayerTextBox.Parent = ScrollingFrame

		local SelectedPlayer = ""

		PlayerTextBox.FocusLost:Connect(function(enter)
			if enter then
				local name = PlayerTextBox.Text
				local match = nil
				for _, pl in ipairs(Players:GetPlayers()) do
					if string.lower(pl.Name):sub(1, #name) == string.lower(name) then
						match = pl.Name
						break
					end
				end
				if match then
					SelectedPlayer = match
					PlayerTextBox.Text = match
					PlayerTextBox.BackgroundColor3 = Color3.fromRGB(40, 70, 40)
				else
					PlayerTextBox.BackgroundColor3 = Color3.fromRGB(70, 40, 40)
				end
			end
		end)

		local commands = {
			{ Name = "üëä Kick", Command = "kick" },
			{ Name = "üíÄ Kill+", Command = "killplus" },
			{ Name = "üîÅ LoopKill", Command = "loopkill" },
			{ Name = "üåÄ Fling", Command = "fling" },
			{ Name = "‚ùÑÔ∏è Freeze", Command = "freeze" },
			{ Name = "üî• Unfreeze", Command = "unfreeze" },
			{ Name = "üì¶ Bring", Command = "bring" },
		}

		local y = 40
		for _, cmd in ipairs(commands) do
			local Button = Instance.new("TextButton")
			Button.Size = UDim2.new(1, 0, 0, 30)
			Button.Position = UDim2.new(0, 0, 0, y)
			Button.BackgroundColor3 = Color3.fromRGB(50, 50, 85)
			Button.Text = cmd.Name
			Button.TextColor3 = Color3.fromRGB(255, 255, 255)
			Button.TextSize = 11
			Button.Font = Enum.Font.GothamSemibold
			Button.Parent = ScrollingFrame

			Button.MouseButton1Click:Connect(function()
				if SelectedPlayer == "" then
					local original = Button.Text
					Button.Text = "‚ùå Nome?"
					task.wait(0.8)
					Button.Text = original
					return
				end
				CreateBillCipherEffect()
				SendCommandMessage(cmd.Command, SelectedPlayer)
			end)

			y += 35
		end

		ScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, y)
	end)
end
