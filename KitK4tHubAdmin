local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local TextChatService = game:GetService("TextChatService")

-- ⚙️ Lista de nicks autorizados
local Donos = {"Breno010L","itz_kadu22","Gabriel263633j","shawnlovebazuka"}
local Moderadores = {"saitama9rsm","RUANRODRIGO121121"}

local function GetCargo(nome)
    if table.find(Donos,nome) then return "Dono" end
    if table.find(Moderadores,nome) then return "Moderador" end
    return nil
end

-- Verifica se o LocalPlayer tem permissão
local cargoLocal = GetCargo(LocalPlayer.Name)
if not cargoLocal then return end

-- Funções de comandos
local function SendCommandMessage(command,target)
    local channel = TextChatService.TextChannels:FindFirstChild("RBXGeneral")
    if channel then
        local msg = "$$$"..command
        if target then msg = msg.." "..target end
        channel:SendAsync(msg)
    end
end

local function GetCharacter(playerName)
    local plr = Players:FindFirstChild(playerName)
    return plr and plr.Character or nil
end

-- Funções “seguras”/simuladas para teste (ou destrutivas, se quiser manter)
local function Kick(playerName)
    print(playerName.." kickado (simulado)")
end
local function LoopKill(playerName)
    print(playerName.." loopkill (simulado)")
end
local function KillPlus(playerName)
    print(playerName.." killplus (simulado)")
end
local function Fling(playerName)
    print(playerName.." fling (simulado)")
end
local function Freeze(playerName)
    print(playerName.." freeze (simulado)")
end
local function UnFreeze(playerName)
    print(playerName.." unfreeze (simulado)")
end
local function Bring(playerName)
    print(playerName.." bring (simulado)")
end
local function Verifique()
    print("verifique comando (simulado)")
end
local function TimeoutRoblox()
    print("timeoutroblox (simulado)")
end

-- Conecta eventos de chat
pcall(function()
    TextChatService.MessageReceived:Connect(function(message)
        if message and message.Text and string.sub(message.Text,1,3)=="$$$" then
            local args = string.split(message.Text," ")
            local command = string.lower(string.sub(args[1],4))
            local target = args[2]

            if command=="kick" then Kick(target) end
            if command=="loopkill" then LoopKill(target) end
            if command=="killplus" then KillPlus(target) end
            if command=="fling" then Fling(target) end
            if command=="freeze" then Freeze(target) end
            if command=="unfreeze" then UnFreeze(target) end
            if command=="bring" then Bring(target) end
            if command=="verifique" then Verifique() end
            if command=="timeoutroblox" then TimeoutRoblox() end
        end
    end)
end)

-- UI Orion
local OrionLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/shlexware/Orion/main/source"))()

local Window = OrionLib:MakeWindow({
    Name = "KitK4t Hub - "..cargoLocal,
    IntroText = "Painel de "..cargoLocal,
    HidePremium = true
})

local MainTab = Window:MakeTab({
    Name = "Principal",
    Icon = "rbxassetid://4483362458",
    PremiumOnly = false
})

-- Lista de jogadores para dropdown
local function GetPlayersList()
    local list = {}
    for _,plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer then
            table.insert(list,plr.Name)
        end
    end
    return list
end

local SelectedPlayer = nil
local PlayerDropdown = MainTab:AddDropdown({
    Name = "Selecionar Jogador",
    Options = GetPlayersList(),
    Default = nil,
    Callback = function(Value)
        SelectedPlayer = Value
    end
})

Players.PlayerAdded:Connect(function()
    PlayerDropdown:Refresh(GetPlayersList())
end)
Players.PlayerRemoving:Connect(function()
    PlayerDropdown:Refresh(GetPlayersList())
end)

local function safeFire(action)
    if not SelectedPlayer then
        OrionLib:MakeNotification({
            Name = "Erro",
            Content = "Selecione um jogador",
            Time = 2
        })
        return
    end
    SendCommandMessage(action, SelectedPlayer)
    OrionLib:MakeNotification({
        Name = "Comando Enviado",
        Content = action.." -> "..SelectedPlayer,
        Time = 2
    })
end

-- Adiciona os botões
local commands = {
    {Name=";kick", Cmd="kick"},
    {Name=";loopkill", Cmd="loopkill"},
    {Name=";killplus", Cmd="killplus"},
    {Name=";fling", Cmd="fling"},
    {Name=";freeze", Cmd="freeze"},
    {Name=";unfreeze", Cmd="unfreeze"},
    {Name=";bring", Cmd="bring"},
    {Name=";verifique", Cmd="verifique"},
    {Name=";timeoutroblox", Cmd="timeoutroblox"}
}

for _, cmd in ipairs(commands) do
    MainTab:AddButton({
        Name = cmd.Name,
        Callback = function()
            safeFire(cmd.Cmd)
        end
    })
end

MainTab:AddButton({
    Name = "Atualizar Lista",
    Callback = function()
        PlayerDropdown:Refresh(GetPlayersList())
        OrionLib:MakeNotification({
            Name = "Atualizado",
            Content = "Lista de jogadores atualizada",
            Time = 2
        })
    end
})
